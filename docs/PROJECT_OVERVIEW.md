# ESIMULATOR é¡¹ç›®æ€»ä½“æ¦‚è¿°

## ğŸ¯ é¡¹ç›®ç›®æ ‡ä¸æˆå°±

ESIMULATORæ˜¯ä¸€ä¸ªä¸“é—¨ç”¨äºData Flow Graph (DFG)çº¿æ€§åˆ†æçš„å·¥å…·å¥—ä»¶ï¼Œé¡¹ç›®çš„æ ¸å¿ƒæˆå°±æ˜¯**å‘ç°å¹¶ä¿®æ­£äº†ä¼ ç»ŸDFGçº¿æ€§åˆ†ææ–¹æ³•ä¸­47ä¸ªç™¾åˆ†ç‚¹çš„é‡å¤§é”™è¯¯**ã€‚

### æ ¸å¿ƒå‘ç°

**ä¿®æ­£å‰åå¯¹æ¯”**ï¼š
- **é”™è¯¯æ–¹æ³•**ï¼š63.2% çº¿æ€§åº¦ï¼ˆè¿ç®—ç¬¦çº§åˆ«ç»Ÿè®¡ï¼‰
- **æ­£ç¡®æ–¹æ³•**ï¼š16.2% çº¿æ€§åº¦ï¼ˆè¡¨è¾¾å¼çº§åˆ«åˆ†æï¼‰
- **ä¿®æ­£å¹…åº¦**ï¼š47ä¸ªç™¾åˆ†ç‚¹ï¼

è¿™ä¸ªä¿®æ­£å¯¹äºç†è§£Intel 4004 ALUç­‰æ•°å­—ç”µè·¯çš„æœ¬è´¨ç‰¹å¾å…·æœ‰é‡è¦æ„ä¹‰ã€‚

## ğŸ“‚ é¡¹ç›®æ–‡ä»¶ç»“æ„æ¦‚è§ˆ

```
ESIMULATOR/
â”œâ”€â”€ ğŸ¯ æ ¸å¿ƒå…¥å£
â”‚   â”œâ”€â”€ analyze_linearity.py          # â­ ä¸»åˆ†æå·¥å…·ï¼ˆæ¨èä½¿ç”¨ï¼‰
â”‚   â””â”€â”€ demo_comparison.py            # ä¿®æ­£æ•ˆæœå¯¹æ¯”æ¼”ç¤º
â”œâ”€â”€ ğŸ”§ æºä»£ç æ¨¡å— (src/)
â”‚   â”œâ”€â”€ analyzers/                    # åˆ†æå™¨æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ dfg_linearity_corrector.py    # â­ ä¿®æ­£çš„çº¿æ€§åˆ†æå™¨ï¼ˆæ ¸å¿ƒï¼‰
â”‚   â”‚   â”œâ”€â”€ analysis_comparator.py        # åˆ†ææ–¹æ³•å¯¹æ¯”å™¨
â”‚   â”‚   â”œâ”€â”€ signal_connection_analyzer.py # ä¿¡å·è¿æ¥åˆ†æå™¨
â”‚   â”‚   â””â”€â”€ [å…¶ä»–åˆ†æå·¥å…·...]
â”‚   â”œâ”€â”€ parsers/                      # DFGè§£æå™¨
â”‚   â”œâ”€â”€ visualizers/                  # å¯è§†åŒ–å·¥å…·
â”‚   â””â”€â”€ utils/                        # å·¥å…·æ¨¡å—
â”œâ”€â”€ ğŸ“Š è¾“å…¥æ•°æ®
â”‚   â”œâ”€â”€ dfg_files/                    # DFGæ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ 4004_dfg.txt             # Intel 4004 ALU DFG
â”‚   â”‚   â””â”€â”€ [å…¶ä»–DFGæ–‡ä»¶...]
â”‚   â””â”€â”€ verilog_files/                # Verilogæºæ–‡ä»¶
â”œâ”€â”€ ğŸ“ˆ åˆ†æç»“æœ (results/)
â”‚   â”œâ”€â”€ corrected_linearity_analysis.txt  # â­ ä¿®æ­£åçš„æ­£ç¡®ç»“æœ
â”‚   â”œâ”€â”€ correct_linearity_analysis.txt    # âŒ åŸå§‹é”™è¯¯ç»“æœï¼ˆä»…ä¾›å¯¹æ¯”ï¼‰
â”‚   â””â”€â”€ data/                         # ç»“æ„åŒ–æ•°æ®
â”œâ”€â”€ ğŸ“š æ–‡æ¡£ (docs/)
â”‚   â”œâ”€â”€ PROJECT_ARCHITECTURE.md       # é¡¹ç›®æ¶æ„æ–‡æ¡£
â”‚   â”œâ”€â”€ USER_MANUAL.md               # ä½¿ç”¨æ‰‹å†Œ
â”‚   â””â”€â”€ [å…¶ä»–æŠ€æœ¯æ–‡æ¡£...]
â””â”€â”€ ğŸ§ª æµ‹è¯•ä¸å¤‡ä»½
    â”œâ”€â”€ tests/                        # æµ‹è¯•æ–‡ä»¶
    â””â”€â”€ backup_before_reorganize/     # é‡æ„å‰å¤‡ä»½
```

## ğŸ”„ æ¨¡å—ä½¿ç”¨é¡ºåºä¸æµç¨‹

### ä¸»è¦å·¥ä½œæµç¨‹

```mermaid
graph TD
    A[DFGè¾“å…¥æ–‡ä»¶] --> B[analyze_linearity.py]
    B --> C[CorrectedLinearityAnalyzer]
    C --> D[è¡¨è¾¾å¼è§£æ]
    D --> E[çº¿æ€§ç‰¹å¾åˆ†æ]
    E --> F[ç»Ÿè®¡æŠ¥å‘Šç”Ÿæˆ]
    F --> G[results/ç›®å½•]
    
    H[ç”¨æˆ·] --> I[demo_comparison.py]
    I --> J[å¯¹æ¯”åˆ†æå±•ç¤º]
    J --> K[ä¿®æ­£æ•ˆæœéªŒè¯]
```

### è¯¦ç»†æ‰§è¡Œæµç¨‹

#### 1. æ•°æ®è¾“å…¥é˜¶æ®µ
```
dfg_files/4004_dfg.txt â†’ æ­£åˆ™è¡¨è¾¾å¼è§£æ â†’ ä¿¡å·è¡¨è¾¾å¼æå–
```

#### 2. æ ¸å¿ƒåˆ†æé˜¶æ®µ
```python
CorrectedLinearityAnalyzer:
    â”œâ”€â”€ analyze_dfg_file()              # æ–‡ä»¶çº§åˆ«åˆ†æ
    â”œâ”€â”€ _analyze_signal_expression()    # ä¿¡å·çº§åˆ«åˆ†æ
    â”œâ”€â”€ _analyze_operator_expression()  # è¿ç®—ç¬¦è¡¨è¾¾å¼åˆ†æ
    â”œâ”€â”€ _analyze_branch_expression()    # åˆ†æ”¯è¡¨è¾¾å¼åˆ†æ
    â””â”€â”€ _generate_comprehensive_report() # æŠ¥å‘Šç”Ÿæˆ
```

#### 3. åˆ†ç±»åˆ¤æ–­é€»è¾‘
```
è¡¨è¾¾å¼ç±»å‹åˆ†æ:
â”œâ”€â”€ Terminal â†’ çº¿æ€§ï¼ˆç›´æ¥èµ‹å€¼ï¼‰
â”œâ”€â”€ IntConst â†’ çº¿æ€§ï¼ˆå¸¸é‡ï¼‰
â”œâ”€â”€ Branch â†’ éçº¿æ€§ï¼ˆæ¡ä»¶åˆ†æ”¯æœ¬è´¨éçº¿æ€§ï¼‰
â”œâ”€â”€ Concat â†’ æ£€æŸ¥å­è¡¨è¾¾å¼
â””â”€â”€ Operator â†’ é€’å½’åˆ†æï¼ˆä¸€ç¥¨å¦å†³åˆ¶ï¼‰
```

#### 4. ç»“æœè¾“å‡ºé˜¶æ®µ
```
åˆ†æç»“æœ â†’ ç»¼åˆæŠ¥å‘Š â†’ æ–‡ä»¶ä¿å­˜ â†’ results/corrected_linearity_analysis.txt
```

## ğŸ§© æ ¸å¿ƒæ¨¡å—è¯´æ˜

### 1. **CorrectedLinearityAnalyzer** (æ ¸å¿ƒå¼•æ“)

**ä½ç½®**: `src/analyzers/dfg_linearity_corrector.py`

**è®¾è®¡åŸç†**:
- **è¡¨è¾¾å¼çº§åˆ«åˆ†æ** vs è¿ç®—ç¬¦çº§åˆ«ç»Ÿè®¡
- **ä¸€ç¥¨å¦å†³åˆ¶**ï¼šè¡¨è¾¾å¼ä¸­æœ‰ä»»ä½•éçº¿æ€§è¿ç®—ç¬¦ â†’ æ•´ä¸ªè¡¨è¾¾å¼éçº¿æ€§
- **æ•°å­¦ä¸¥è°¨æ€§**ï¼šä¸¥æ ¼æŒ‰ç…§çº¿æ€§å‡½æ•°å®šä¹‰ `f(ax + by) = af(x) + bf(y)`

**å…³é”®ç®—æ³•**:
```python
# è¿ç®—ç¬¦åˆ†ç±»ï¼ˆé‡æ–°å®šä¹‰ï¼‰
linear_operators = {'Plus', 'Minus', 'UnaryMinus', 'Concat', 'Partselect'}
nonlinear_operators = {'And', 'Or', 'Xor', 'Unot', 'Sll', 'Srl', ...}

# è¡¨è¾¾å¼åˆ†æï¼ˆé€’å½’åˆ¤æ–­ï¼‰
def _analyze_operator_expression(expr):
    for operator in extract_operators(expr):
        if operator in nonlinear_operators:
            return False  # ä¸€ç¥¨å¦å†³
    return True
```

### 2. **ä¸»å…¥å£ç¨‹åº** (`analyze_linearity.py`)

**åŠŸèƒ½**: ç”¨æˆ·å‹å¥½çš„åˆ†æå·¥å…·å…¥å£

**ä½¿ç”¨æ–¹æ³•**:
```bash
python analyze_linearity.py
```

**è¾“å‡º**: ç”Ÿæˆè¯¦ç»†çš„çº¿æ€§åˆ†ææŠ¥å‘Šåˆ° `results/` ç›®å½•

### 3. **å¯¹æ¯”æ¼”ç¤ºå·¥å…·** (`demo_comparison.py`)

**åŠŸèƒ½**: æ¼”ç¤ºä¿®æ­£å‰åçš„å·¨å¤§å·®å¼‚

**æ ¸å¿ƒä»·å€¼**: éªŒè¯ä¿®æ­£æ–¹æ³•çš„æ­£ç¡®æ€§å’Œå¿…è¦æ€§

## ğŸ“ æŠ€æœ¯åŸç†æ·±åº¦è§£æ

### ä¸ºä»€ä¹ˆä¿®æ­£å¹…åº¦å¦‚æ­¤å·¨å¤§ï¼Ÿ

#### åŸå§‹é”™è¯¯æ–¹æ³•
```python
# é”™è¯¯ï¼šæŒ‰è¿ç®—ç¬¦ä¸ªæ•°ç»Ÿè®¡
linear_ops = count('+', '-')      # 294ä¸ª
nonlinear_ops = count('&', '|')   # 171ä¸ª
linearity = linear_ops / (linear_ops + nonlinear_ops)  # 63.2%
```

**é—®é¢˜**: å¿½ç•¥äº†è¡¨è¾¾å¼çš„æ•´ä½“ç»“æ„

#### ä¿®æ­£åçš„æ­£ç¡®æ–¹æ³•
```python
# æ­£ç¡®ï¼šæŒ‰è¡¨è¾¾å¼æ•´ä½“ç‰¹å¾åˆ¤æ–­
for expression in all_expressions:
    if has_any_nonlinear_operator(expression):
        mark_as_nonlinear(expression)    # æ•´ä¸ªè¡¨è¾¾å¼éçº¿æ€§
    else:
        mark_as_linear(expression)       # æ•´ä¸ªè¡¨è¾¾å¼çº¿æ€§
```

**åŸç†**: ä¸€ä¸ªè¡¨è¾¾å¼å¯èƒ½åŒ…å«100ä¸ªåŠ æ³•è¿ç®—ç¬¦ï¼Œä½†åªè¦æœ‰1ä¸ªé€»è¾‘ANDï¼Œæ•´ä¸ªè¡¨è¾¾å¼å°±æ˜¯éçº¿æ€§çš„ã€‚

### å…³é”®æŠ€æœ¯å†³ç­–

#### 1. ä½ç§»è¿ç®—é‡æ–°åˆ†ç±»
```
åŸåˆ†ç±»: Sll, Srl â†’ çº¿æ€§
ä¿®æ­£åˆ†ç±»: Sll, Srl â†’ éçº¿æ€§
ç†ç”±: x << n â‰¡ x Ã— 2â¿ (ä¹˜æ³•è¿ç®—ï¼Œæœ¬è´¨éçº¿æ€§)
```

#### 2. è¡¨è¾¾å¼æ ‘é€’å½’åˆ†æ
```python
def analyze_expression_tree(node):
    if node.type == 'operator':
        if node.operator in nonlinear_set:
            return 'nonlinear'
        else:
            # é€’å½’æ£€æŸ¥æ‰€æœ‰å­èŠ‚ç‚¹
            for child in node.children:
                if analyze_expression_tree(child) == 'nonlinear':
                    return 'nonlinear'
    return 'linear'
```

#### 3. æ¡ä»¶åˆ†æ”¯ç‰¹æ®Šå¤„ç†
```python
# åˆ†æ”¯è¡¨è¾¾å¼æœ¬è´¨éçº¿æ€§
if expression.startswith('(Branch '):
    return 'nonlinear'  # æ¡ä»¶é€»è¾‘æœ¬è´¨ä¸Šæ˜¯éçº¿æ€§çš„
```

## ğŸ“Š åˆ†æç»“æœæ„ä¹‰

### Intel 4004 ALUç‰¹å¾
- **83.8% éçº¿æ€§**ï¼šä¸»è¦ç”±é€»è¾‘è¿ç®—ã€æ¡ä»¶åˆ†æ”¯æ„æˆ
- **16.2% çº¿æ€§**ï¼šä¸»è¦æ˜¯ç›´æ¥èµ‹å€¼ã€å¸¸é‡ã€ç®€å•æ‹¼æ¥

**å·¥ç¨‹æ„ä¹‰**: è¿™ä¸ªç»“æœç¬¦åˆALUä½œä¸ºé€»è¾‘è¿ç®—å•å…ƒçš„æœ¬è´¨ç‰¹å¾ï¼ŒéªŒè¯äº†ä¿®æ­£æ–¹æ³•çš„æ­£ç¡®æ€§ã€‚

### å¯¹æ¯”å…¶ä»–åˆ†ææ–¹æ³•
| æ–¹æ³• | çº¿æ€§åº¦ | åˆ†æçº§åˆ« | æ•°å­¦æ­£ç¡®æ€§ |
|------|--------|----------|------------|
| åŸå§‹ç»Ÿè®¡æ³• | 63.2% | è¿ç®—ç¬¦ | âŒ é”™è¯¯ |
| ä¿®æ­£è¡¨è¾¾å¼æ³• | 16.2% | è¡¨è¾¾å¼ | âœ… æ­£ç¡® |

## ğŸ”§ æ‰©å±•æ€§ä¸åº”ç”¨

### æ”¯æŒçš„åˆ†æç±»å‹
1. **çº¿æ€§åº¦åˆ†æ** - æ ¸å¿ƒåŠŸèƒ½
2. **ä¿¡å·è¿æ¥åˆ†æ** - æ‹“æ‰‘ç»“æ„
3. **å¤æ‚åº¦åˆ†æ** - è¡¨è¾¾å¼å¤æ‚åº¦
4. **å¯è§†åŒ–åˆ†æ** - å›¾å½¢åŒ–å±•ç¤º

### åº”ç”¨åœºæ™¯
- æ•°å­—ç”µè·¯è®¾è®¡åˆ†æ
- ç¡¬ä»¶æè¿°è¯­è¨€ä¼˜åŒ–
- ç”µè·¯å¤æ‚åº¦è¯„ä¼°
- å­¦æœ¯ç ”ç©¶ä¸æ•™å­¦

## ğŸ“š ç›¸å…³æ–‡æ¡£å¯¼èˆª

- **[é¡¹ç›®æ¶æ„æ–‡æ¡£](PROJECT_ARCHITECTURE.md)** - è¯¦ç»†çš„æŠ€æœ¯æ¶æ„
- **[ç”¨æˆ·ä½¿ç”¨æ‰‹å†Œ](USER_MANUAL.md)** - è¯¦ç»†çš„ä½¿ç”¨æŒ‡å—
- **[DFGæ¡†æ¶è¯´æ˜](README_DFG_Framework.md)** - DFGå¤„ç†æ¡†æ¶
- **[é¡¹ç›®é‡æ„æŠ¥å‘Š](../REORGANIZATION_REPORT.md)** - é¡¹ç›®æ”¹è¿›å†ç¨‹

## ğŸ† é¡¹ç›®ä»·å€¼æ€»ç»“

1. **ç§‘å­¦ä»·å€¼**: å‘ç°å¹¶ä¿®æ­£äº†ä¼ ç»Ÿåˆ†ææ–¹æ³•çš„é‡å¤§ç¼ºé™·
2. **å·¥ç¨‹ä»·å€¼**: æä¾›äº†æ•°å­¦ä¸Šä¸¥è°¨çš„çº¿æ€§åˆ†æå·¥å…·
3. **æ•™è‚²ä»·å€¼**: å±•ç¤ºäº†ç®—æ³•è®¾è®¡ä¸­æ•°å­¦å®šä¹‰çš„é‡è¦æ€§
4. **å®ç”¨ä»·å€¼**: ä¸ºæ•°å­—ç”µè·¯åˆ†ææä¾›äº†å¯é çš„å·¥å…·åŸºç¡€

**æ ¸å¿ƒè´¡çŒ®**: ä»"è¿ç®—ç¬¦ç»Ÿè®¡"åˆ°"è¡¨è¾¾å¼åˆ†æ"çš„æ–¹æ³•è®ºçªç ´ï¼Œä¸ºDFGçº¿æ€§åˆ†æå»ºç«‹äº†æ–°çš„æ ‡å‡†ã€‚
